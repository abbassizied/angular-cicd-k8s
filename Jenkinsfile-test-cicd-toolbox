/*  
  Requires the Kubernetes plugin to be installed in Jenkins 
  and Jenkins itself to be running within a Kubernetes cluster.
*/

pipeline {
    agent {
        kubernetes {
            yaml """
kind: Pod
apiVersion: v1
metadata:
  labels:
    app: jenkins-agent
    role: cicd-toolbox
spec:
  containers:
  - name: cicd-toolbox
    image: ziedab/jenkins-cicd-toolbox
    command:
    - cat
    tty: true
"""
        }
    }
    stages {
        stage('test k8s commands') {
            steps {
                container('cicd-toolbox') {
         echo POD_CONTAINER // displays 'busybox'
        sh 'hostname'                   
                    sh 'kubectl cluster-info'
                    // Uncomment the following line to check the Node.js version
                    // sh 'node --version'
                }
            }
        }
    }
}
