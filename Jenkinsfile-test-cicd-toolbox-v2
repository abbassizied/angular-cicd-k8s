/*  
  Requires the Kubernetes plugin to be installed in Jenkins 
  and Jenkins itself to be running within a Kubernetes cluster.
*/

pipeline {
    agent {
        kubernetes {
            yamlFile 'KubernetesPod.yaml'
        }
    }
    stages {

        stage('Clone repository') {
            /* Let's make sure we have the repository cloned to our workspace */
            checkout scm
        }  

        stage('test k8s commands') {
            steps {
                container('cicd-toolbox') {
                    // echo POD_CONTAINER // displays 'busybox'
                    // sh 'hostname'                   
                    sh 'helm upgrade --install angular -n jenkins ./helm/angularchart'
                    // Uncomment the following line to check the Node.js version
                    // sh 'node --version'
                }
            }
        }
    }
}
